/**
 * zooming - Image zoom with pure JavaScript.
 * @version v0.4.0
 * @link https://github.com/kingdido999/zooming
 * @license MIT
 */

+function(){function e(e,n,o){t(n);var i=e.style,r={};for(var a in n)o&&(r[a]=i[a]||""),i[a]=n[a];return r}function n(){var e={},n=["webkitTransition","transition","mozTransition"],t=["webkitTransform","transform","mozTransform"],o={transition:"transitionend",mozTransition:"transitionend",webkitTransition:"webkitTransitionEnd"};return n.some(function(n){if(void 0!==E.style[n])return e.transition=n,e.transEnd=o[n],!0}),t.some(function(n){if(void 0!==E.style[n])return e.transform=n,!0}),e}function t(e){var n;e.transition&&(n=e.transition,delete e.transition,e[A]=n),e.transform&&(n=e.transform,delete e.transform,e[O]=n)}function o(){var e=g.width/2,n=g.height/2,t={x:g.left+e,y:g.top+n},o={x:window.innerWidth/2,y:window.innerHeight/2},i={x:o.x-e,y:o.y-n},r=i.x/e,a=i.y/n;v={x:o.x-t.x,y:o.y-t.y},m=k.scaleBase+Math.min(r,a);var s="translate("+v.x+"px,"+v.y+"px) scale("+m+")";return s}function i(){var e=window.pageYOffset||(document.documentElement||h.parentNode||h).scrollTop;null===B&&(B=e);var n=B-e;Math.abs(n)>=k.scrollThreshold&&(B=null,G.close())}function r(e){var n=e.key||e.code;"Escape"!==n&&27!==e.keyCode||G.close()}function a(e){e.preventDefault(),y=setTimeout(function(){L=!0,G.grab(e.clientX,e.clientY)},200)}function s(e){L&&G.grab(e.clientX,e.clientY)}function l(){clearTimeout(y),L=!1,G.release()}var c,u,d,f,m,v,p,g,y,b="WebkitAppearance"in document.documentElement.style?"-webkit-":"",h=document.body,E=document.createElement("div"),w=!1,x=!1,L=!1,T=!1,B=null,k={transitionDuration:".4s",transitionTimingFunction:"cubic-bezier(.4,0,0,1)",bgColor:"#fff",bgOpacity:1,scaleBase:1,scaleExtra:.5,scrollThreshold:40,onOpen:null,onClose:null,onGrab:null,onRelease:null,onBeforeOpen:null,onBeforeClose:null,onBeforeGrab:null,onBeforeRelease:null},C=n(),A=C.transition,O=C.transform,z=O.replace(/(.*)Transform/,"-$1-transform"),D=C.transEnd,G={config:function(n){if(!n)return k;for(var t in n)k[t]=n[t];return e(E,{backgroundColor:k.bgColor,transition:"opacity "+k.transitionDuration+" "+k.transitionTimingFunction}),this},open:function(n,t){if(!(w||x||T)&&(c="string"==typeof n?document.querySelector(n):n,"IMG"===c.tagName)){k.onBeforeOpen&&k.onBeforeOpen(c),w=!0,x=!0,u=c.parentNode;var m=new Image;return m.onload=function(){g=c.getBoundingClientRect(),c.hasAttribute("data-original")&&(p=c.getAttribute("src"),e(c,{width:g.width+"px",height:g.height+"px"}),c.setAttribute("src",c.getAttribute("data-original"))),c.offsetWidth,f={position:"relative",zIndex:999,cursor:b+"grab",transition:z+" "+k.transitionDuration+" "+k.transitionTimingFunction,transform:o()},d=e(c,f,!0)},m.src=c.getAttribute("src"),u.appendChild(E),setTimeout(function(){E.style.opacity=k.bgOpacity},30),document.addEventListener("scroll",i),document.addEventListener("keydown",r),c.addEventListener(D,function e(){c.removeEventListener(D,e),c.addEventListener("mousedown",a),c.addEventListener("mousemove",s),c.addEventListener("mouseup",l),x=!1,t=t||k.onOpen,t&&t(c)}),this}},close:function(n){if(w&&!x&&!T)return x=!0,k.onBeforeClose&&k.onBeforeClose(c),E.style.opacity=0,c.style.transform="",document.removeEventListener("scroll",i),document.removeEventListener("keydown",r),c.addEventListener(D,function t(){c.removeEventListener(D,t),c.removeEventListener("mousedown",a),c.removeEventListener("mousemove",s),c.removeEventListener("mouseup",l),e(c,d),u.removeChild(E),w=!1,x=!1,T=!1,c.hasAttribute("data-original")&&c.setAttribute("src",p),n="function"==typeof n?n:k.onClose,n&&n(c)}),this},grab:function(n,t,o){if(w&&!x){T=!0,k.onBeforeGrab&&k.onBeforeGrab(c);var i=n-window.innerWidth/2,r=t-window.innerHeight/2,a=c.style.transform,s=a.replace(/translate\(.*?\)/i,"translate("+(v.x+i)+"px,"+(v.y+r)+"px) ").replace(/scale\([0-9|\.]*\)/i,"scale("+(m+k.scaleExtra)+")");e(c,{cursor:b+"grabbing",transition:z+" .1s",transform:s}),c.addEventListener(D,function e(){c.removeEventListener(D,e),o=o||k.onGrab,o&&o(c)})}},release:function(n){if(w&&!x&&T)return k.onBeforeRelease&&k.onBeforeRelease(c),e(c,f),c.addEventListener(D,function e(){c.removeEventListener(D,e),T=!1,n="function"==typeof n?n:k.onRelease,n&&n(c)}),this},listen:function(e){if("string"==typeof e){for(var n=document.querySelectorAll(e),t=n.length;t--;)this.listen(n[t]);return this}return e.style.cursor=b+"zoom-in",e.addEventListener("click",function(n){n.stopPropagation(),w?G.close():G.open(e)}),this}};e(E,{zIndex:998,background:k.bgColor,position:"fixed",top:0,left:0,right:0,bottom:0,opacity:0,transition:"opacity "+k.transitionDuration+" "+k.transitionTimingFunction}),E.addEventListener("click",G.close),document.addEventListener("DOMContentLoaded",G.listen('img[data-action="zoom"]')),"object"==typeof exports?module.exports=G:"function"==typeof define&&define.amd?define(function(){return G}):this.Zooming=G}();